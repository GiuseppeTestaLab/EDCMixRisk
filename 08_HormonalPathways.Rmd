---
title: "10_HormonalPathways"
output:
    html_document:
        toc: true
        toc_float: true
        collapsed: true
        theme: 'simplex'
        highlight: 'espresso'
        code_folding: hide
---

### Data loading

```{r, warning=FALSE, message=FALSE}
suppressPackageStartupMessages({
  library(SummarizedExperiment)
  library(SEtools)
  library(edgeR)
  library(DT)
  library(pheatmap)
  library(plotly)
  library(dplyr)
  library(sva)
  library(msigdbr)
  library(reshape2)
  library(overlapper)
})
source("Functions/EDC_Functions.R")
source("Functions/CriFormatted.R")
load("Data/geneLengths.RData")
load("Data/AllSEcorrected.RData",verbose=T)
load("Data/TotalSumExp.RData", verbose = T)
```


## Overlap DEGs and hormonal genes
```{r, message=FALSE,collapse=TRUE, fig.height=6}
load("Data/HormonalGenes/HormonalGenes.RData",verbose = T)
load("Data/HormonalGenes/HormonalTFs/TF.RData", verbose = T)

uni <-rownames(filterGenes(Total))

degs.fe <- row.names(DEAs$chronic.fetal)[which((abs(DEAs$chronic.fetal$logFC.EXPO1X)>0.5 | abs(DEAs$chronic.fetal$logFC.EXPO1000X)>0.5) & DEAs$chronic.fetal$FDR<=0.05 & DEAs$chronic.fetal$logCPM>0)]
degs.org <- row.names(DEAs$chronic.org)[which((abs(DEAs$chronic.org$logFC.EXPO1X)>0.5 | abs(DEAs$chronic.org$logFC.EXPO1000X)>0.5) & DEAs$chronic.org$FDR<=0.05 & DEAs$chronic.org$logCPM > 0)]
degs <- list(Fetal=degs.fe, Organoids= degs.org, Both= union(degs.org,degs.fe))
TF <- list(Fetal=FetTF, Organoids= OrgTF, Both= union(OrgTF,FetTF))
hormonal <- list(Thyroid=Thyroid, Androgen=Androgen, Estrogen=Estrogen, Corticoid=Corticoid,Progesterone=Progesterone,PPAR=PPAR, Retinoic=Retinoic, All= union(Thyroid,union(Androgen, union(Estrogen,union(Corticoid, union(Progesterone,union(PPAR,Retinoic)))))))

m <- overlapper::multintersect(degs, hormonal, universe = uni)
overlapper::dotplot.multintersect(m)
```

## Overlap DEGs long list and hormonal genes
```{r, message=FALSE,collapse=TRUE, fig.height=6}
load("Data/HormonalGenes/HormonalGenes.RData",verbose = T)
load("Data/HormonalGenes/HormonalTFs/TF.RData", verbose = T)

uni <-rownames(filterGenes(Total))

degs.fe <- row.names(DEAs$chronic.fetal)[which(DEAs$chronic.fetal$FDR<=0.1)]
degs.org <- row.names(DEAs$chronic.org)[which(DEAs$chronic.org$FDR<=0.1 )]
degs <- list(Fetal=degs.fe, Organoids= degs.org, Both= union(degs.org,degs.fe))
TF <- list(Fetal=FetTF, Organoids= OrgTF, Both= union(OrgTF,FetTF))
hormonal <- list(Thyroid=Thyroid, Androgen=Androgen, Estrogen=Estrogen, Corticoid=Corticoid,Progesterone=Progesterone,PPAR=PPAR, Retinoic=Retinoic, All= union(Thyroid,union(Androgen, union(Estrogen,union(Corticoid, union(Progesterone,union(PPAR,Retinoic)))))))

m <- overlapper::multintersect(degs, hormonal, universe = uni)
overlapper::dotplot.multintersect(m)
```


## Overlap TFs and hormonal genes
```{r, message=FALSE,collapse=TRUE,fig.height=6}
load("Data/regulon_weighted.RData", verbose = T)
uni <- as.character(names(regulon))
m <- overlapper::multintersect(TF, hormonal, universe = uni)
overlapper::dotplot.multintersect(m)
```

## Heatmaps of hormonal DEGs
```{r, message=FALSE,collapse=TRUE}
SEs <- list(chronic.org=SEs$chronic.org, chronic.fetal=SEs$chronic.fetal)
merged <- mergeSEs(SEs, use.assays = "corrected", commonOnly=T)
merged <- merged[,which(merged$EXPO=="CNT"|merged$EXPO=="1X" | merged$EXPO=="1000X")]

load("Data/HormonalGenes/HormonalDEGs/HormonalDEGs.RData", verbose = T)
HormonalAll <- union(Thyroid,union(Androgen, union(Estrogen,union(Corticoid, union(Progesterone,union(PPAR,Retinoic))))))
degs<- union(degs.fe,degs.org)
TF<- union(FetTF,OrgTF)

breaks <- c(-8,-3,seq(from=-2.5,to=2.5,length.out=24),3,8)
sehm(merged, intersect(degs,HormonalAll), gaps_at = "Dataset",  show_rownames = F, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Hormonal DEGs",cluster_rows = T)

sehm(merged, ThyroidDEGs, gaps_at = "Dataset",  show_rownames = F, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Thyroid genes",cluster_rows = T)

sehm(merged, AndrogenDEGs, gaps_at = "Dataset",  show_rownames = F, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Androgen genes",cluster_rows = T)

sehm(merged, EstrogenDEGs, gaps_at = "Dataset",  show_rownames = F, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Estrogen genes",cluster_rows = T)

sehm(merged, CorticoidDEGs, gaps_at = "Dataset",  show_rownames = T, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Corticoid genes",cluster_rows = T)

sehm(merged, PPARDEGs, gaps_at = "Dataset",  show_rownames = T, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="PPAR genes",cluster_rows = T)

sehm(merged, ProgesteroneDEGs, gaps_at = "Dataset",  show_rownames = F, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Progesteron genes",cluster_rows = T)

sehm(merged, RetinoicDEGs, gaps_at = "Dataset",  show_rownames = F, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Retinoic Acid genes",cluster_rows = T)
```

## Heatmaps of hormonal Psychencode Transciprion Factors
```{r, message=FALSE,collapse=TRUE}
load("Data/HormonalGenes/HormonalTFs/Psychencode/HormonalPsychencode.RData", verbose = T)

breaks <- c(-8,-3,seq(from=-2.5,to=2.5,length.out=24),3,8)
sehm(merged, intersect(TF,HormonalAll), gaps_at = "Dataset",  show_rownames = F, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Hormonal TF",cluster_rows = T)

sehm(merged, ThyroidTF, gaps_at = "Dataset",  show_rownames = T, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Thyroid genes",cluster_rows = T)

sehm(merged, AndrogenTF, gaps_at = "Dataset",  show_rownames = T, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Androgen genes",cluster_rows = T)

sehm(merged, EstrogenTF, gaps_at = "Dataset",  show_rownames = T, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Estrogen genes",cluster_rows = T)

sehm(merged, CorticoidTF, gaps_at = "Dataset",  show_rownames = T, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Corticoid genes",cluster_rows = T)

sehm(merged, PPARTF, gaps_at = "Dataset",  show_rownames = T, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="PPAR genes",cluster_rows = T)

sehm(merged, ProgesteroneTF, gaps_at = "Dataset",  show_rownames = T, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Progesteron genes",cluster_rows = T)

sehm(merged, RetinoicTF, gaps_at = "Dataset",  show_rownames = T, anno_columns = c("Dataset","EXPO2"), breaks = breaks, main="Retinoic Acid genes",cluster_rows = T)
```


### Data praparation

For details on data filtering, normalization, batch correction and differential expression analysis, see [here](./DataPreparation/SVAcorrectedObjects.html) 

For details on the preparation of Hormonal pathways genes, see [here](./DataPreparation/HormonalPathway/DataPreparationHormonalGenes.html) 

***

To continue with the results you can go [here](12_Immunofluorescence.html)

```{r child='footer.Rmd'}
```
