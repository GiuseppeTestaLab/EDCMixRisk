---
title: "3_MixN_ChronicFetal"
output:
    html_document:
        toc: true
        toc_float: true
        collapsed: true
        theme: 'simplex'
        highlight: 'espresso'
        code_folding: hide
---

### Data loading

```{r, warning=FALSE, message=FALSE}
suppressPackageStartupMessages({
  library(SummarizedExperiment)
  library(SEtools)
  library(edgeR)
  library(DT)
  library(pheatmap)
  library(plotly)
  library(dplyr)
  library(sva)
  library(reshape2)
  library(overlapper)
})
source("Functions/EDC_Functions.R")
source("Functions/CriFormatted.R")
load("Data/AllSEcorrected.RData",verbose=T)
```

### DEGs heatmaps
```{r,message=FALSE,collapse=TRUE, fig.width=10, fig.height=10}
fetal.chronic <- row.names(DEAs$chronic.fetal)[which((abs(DEAs$chronic.fetal$logFC.EXPO1X)>0.5 | abs(DEAs$chronic.fetal$logFC.EXPO1000X)>0.5) & DEAs$chronic.fetal$FDR<=0.05 & DEAs$chronic.fetal$logCPM>0)]

save(fetal.chronic,file = "Data/DEGsFetalChronic.RData")

MixN_fetal_chronic <- SEs$chronic.fetal[,which(SEs$chronic.fetal$EXPO=="CNT"|SEs$chronic.fetal$EXPO=="1X" | SEs$chronic.fetal$EXPO=="1000X")]
sehm(MixN_fetal_chronic, assayName = "corrected", fetal.chronic,  do.scale = T, show_rownames = F, anno_columns = c("Line","EXPO2"), main="Chronic fetal DEGs")
```

### Most significant and highly disregulated DEGs heatmaps

```{r,message=FALSE,collapse=TRUE, fig.width=10, fig.height=10}
fetal.chronic2 <- row.names(DEAs$chronic.fetal)[which((abs(DEAs$chronic.fetal$logFC.EXPO1X)>1 | abs(DEAs$chronic.fetal$logFC.EXPO1000X)>1) & DEAs$chronic.fetal$FDR<=0.05 & DEAs$chronic.fetal$logCPM>0)]

MixN_fetal_chronic <- SEs$chronic.fetal[,which(SEs$chronic.fetal$EXPO=="CNT"|SEs$chronic.fetal$EXPO=="1X" | SEs$chronic.fetal$EXPO=="1000X")]

sehm(MixN_fetal_chronic, assayName = "corrected", fetal.chronic2,  do.scale = T, show_rownames = T, anno_columns = c("Line","EXPO2"), main="Chronic fetal DEGs")
```

### 1X vs 1000X

```{r,message=FALSE,collapse=TRUE, fig.width=10, fig.height=10}
FDRTh <- 0.05
LogFCTh <- 0.5

MixN1X <- DEAs$chronic.fetal
MixN1X$genes <- row.names(MixN1X)
MixN1X$logFC <- (MixN1X$logFC.EXPO1X)

MixN1000X <- DEAs$chronic.fetal
MixN1000X$genes <- row.names(MixN1000X)
MixN1000X$logFC <- (MixN1X$logFC.EXPO1000X)

Comp <- compareResultsFC(MixN1X, MixN1000X, FDRth=0.05, FCth=2^0.5, FDRceil=1e-10,logCPMth = 0, FCceil=8, title='Comparing MixN 1X to 1000X', geneLabel=TRUE)

Comp$Scatter
```

### Neurodevelopmental Disorder Genes 

```{r, message=FALSE,collapse=TRUE, fig.height=6}
load("Data/ASD.RData", verbose = T)
fetal.chronic3 <- row.names(DEAs$chronic.fetal)[which(DEAs$chronic.fetal$FDR<=0.05)]

MixN <- list(fetalDEGsLong=fetal.chronic3, fetalDEGs=fetal.chronic)

m <- overlapper::multintersect(ll = MixN, ll2 = ASD, universe = row.names(DEAs$chronic.fetal))
overlapper::dotplot.multintersect(m,sizeRange = c(0,15))

m <- overlapper::multintersect(ll = MixN, ll2 = SFARIgenes, universe = row.names(DEAs$chronic.fetal))
overlapper::dotplot.multintersect(m)
```

### Gene expression dysregulation of the most important NDD genes

```{r, message=FALSE,collapse=TRUE}
geneStripPairEDCMix(SE = MixN_fetal_chronic,GeneSet = intersect(fetal.chronic, unlist(SFARIgenes)), printExp = FALSE,SampleColors = "Default")
```

### Gene expression dysregulation of the chronic organoids NDD-DEGs in fetal dataset

```{r, message=FALSE,collapse=TRUE}
load("Data/DEGsOrganoidsChronic.RData", verbose = T)
geneStripPairEDCMix(SE = MixN_fetal_chronic,GeneSet = intersect(org.chronic, union(union(SFARIgenes$score1,SFARIgenes$score2),SFARIgenes$score3)), printExp = FALSE,SampleColors = "Default")
```

### Gene expression dysregulation of the genes found in the acute expo

```{r, message=FALSE,collapse=TRUE}
load("Data/DEGsFetalAcute.RData", verbose = T)

geneStripPairEDCMix(SE = MixN_fetal_chronic,GeneSet = intersect(fet.acute,fetal.chronic), printExp = FALSE,SampleColors = "Default")

geneStripPairEDCMix(SE = MixN_fetal_chronic,GeneSet = c("CLSTN2", "EPHB2"), printExp = FALSE,SampleColors = "Default")
```


### Data praparation

For details on data filtering, normalization, batch correction and differential expression analysis, see [here](./DataPreparation/SVAcorrectedObjects.html) 

For details on the preparation of Neurodevelopmental disorder genes, see [here](./DataPreparation/ASD/DataPreparation.html) 

***

```{r child='footer.Rmd'}
```

```{r SaveSession}
sessionInfo()
```
